{
    "sourceFile": "src/components/Chat.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1753249921768,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1753250026179,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,21 +8,17 @@\n   const user = JSON.parse(localStorage.getItem('user'));\r\n   const [socket, setSocket] = useState(null);\r\n \r\n   useEffect(() => {\r\n-    const token = localStorage.getItem('authToken');\r\n     // Fetch chat history for this group\r\n-    fetch(`${import.meta.env.VITE_API_BASE_URL.replace(/\\/api\\/v1$/, '')}/api/chat/${groupId}`, {\r\n-      headers: token ? { Authorization: `Bearer ${token}` } : {}\r\n-    })\r\n+    fetch(`${import.meta.env.VITE_API_BASE_URL.replace(/\\/api\\/v1$/, '')}/api/chat/${groupId}`)\r\n       .then(res => res.json())\r\n       .then(data => setMessages(data));\r\n   }, [groupId]);\r\n \r\n   useEffect(() => {\r\n-    const token = localStorage.getItem('authToken');\r\n     const newSocket = io(import.meta.env.VITE_SOCKET_URL || 'http://localhost:8004', {\r\n-      query: { groupId, token },\r\n+      query: { groupId }\r\n     });\r\n     setSocket(newSocket);\r\n \r\n     newSocket.on('chat_history', (msgs) => setMessages(msgs));\r\n"
                },
                {
                    "date": 1753250038109,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,17 +8,21 @@\n   const user = JSON.parse(localStorage.getItem('user'));\r\n   const [socket, setSocket] = useState(null);\r\n \r\n   useEffect(() => {\r\n+    const token = localStorage.getItem('authToken');\r\n     // Fetch chat history for this group\r\n-    fetch(`${import.meta.env.VITE_API_BASE_URL.replace(/\\/api\\/v1$/, '')}/api/chat/${groupId}`)\r\n+    fetch(`${import.meta.env.VITE_API_BASE_URL.replace(/\\/api\\/v1$/, '')}/api/chat/${groupId}`, {\r\n+      headers: token ? { Authorization: `Bearer ${token}` } : {}\r\n+    })\r\n       .then(res => res.json())\r\n       .then(data => setMessages(data));\r\n   }, [groupId]);\r\n \r\n   useEffect(() => {\r\n+    const token = localStorage.getItem('authToken');\r\n     const newSocket = io(import.meta.env.VITE_SOCKET_URL || 'http://localhost:8004', {\r\n-      query: { groupId }\r\n+      query: { groupId, token },\r\n     });\r\n     setSocket(newSocket);\r\n \r\n     newSocket.on('chat_history', (msgs) => setMessages(msgs));\r\n"
                }
            ],
            "date": 1753249921768,
            "name": "Commit-0",
            "content": "import React, { useEffect, useRef, useState } from 'react';\r\nimport { io } from 'socket.io-client';\r\n\r\nconst Chat = ({ groupId = 'global' }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const messagesEndRef = useRef(null);\r\n  const user = JSON.parse(localStorage.getItem('user'));\r\n  const [socket, setSocket] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('authToken');\r\n    // Fetch chat history for this group\r\n    fetch(`${import.meta.env.VITE_API_BASE_URL.replace(/\\/api\\/v1$/, '')}/api/chat/${groupId}`, {\r\n      headers: token ? { Authorization: `Bearer ${token}` } : {}\r\n    })\r\n      .then(res => res.json())\r\n      .then(data => setMessages(data));\r\n  }, [groupId]);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('authToken');\r\n    const newSocket = io(import.meta.env.VITE_SOCKET_URL || 'http://localhost:8004', {\r\n      query: { groupId, token },\r\n    });\r\n    setSocket(newSocket);\r\n\r\n    newSocket.on('chat_history', (msgs) => setMessages(msgs));\r\n    newSocket.on('receive_message', (msg) => setMessages(prev => [...prev, msg]));\r\n\r\n    return () => {\r\n      newSocket.disconnect();\r\n    };\r\n  }, [groupId]);\r\n\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  const sendMessage = (e) => {\r\n    e.preventDefault();\r\n    if (input.trim() && socket) {\r\n      socket.emit('send_message', {\r\n        text: input,\r\n        userId: user?.id,\r\n        username: user?.username,\r\n        groupId\r\n      });\r\n      setInput('');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col p-3 h-100vh bg-gradient-to-b from-black to-pink-900 font-sans w-full mx-auto rounded-lg shadow-lg border border-gray-800\">\r\n      <div className=\"overflow-y-auto hide-scrollbar space-y-3 pb-2\">\r\n        {messages.map((msg, idx) => (\r\n          <div key={idx} className=\"flex flex-col\">\r\n            <span className=\"text-xs font-bold text-white mb-1 ml-1\">{msg.username || 'Anonymous'}</span>\r\n            <div\r\n              className={\r\n                msg.offensive\r\n                  ? 'border-2 border-yellow-400 bg-yellow-900/20 text-yellow-300 font-bold rounded-lg px-4 py-3 text-sm text-center'\r\n                  : 'bg-[#18111A] text-white rounded-lg px-4 py-3 text-sm font-normal'\r\n              }\r\n            >\r\n              {msg.message || msg.text}\r\n            </div>\r\n          </div>\r\n        ))}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n      <form onSubmit={sendMessage} className=\"flex items-center border-t border-pink-900 mt-4 pt-3 gap-2\">\r\n        <input\r\n          className=\"flex-1 bg-transparent text-white placeholder:text-gray-300 px-3 py-2 border border-yellow-400 rounded-lg outline-none text-sm\"\r\n          placeholder=\"Type your message...\"\r\n          value={input}\r\n          onChange={e => setInput(e.target.value)}\r\n        />\r\n        <button\r\n          className=\"bg-yellow-400 text-black font-bold px-5 py-2 rounded-lg text-base hover:bg-yellow-500 transition-colors\"\r\n          type=\"submit\"\r\n        >\r\n          Send\r\n        </button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat;"
        }
    ]
}